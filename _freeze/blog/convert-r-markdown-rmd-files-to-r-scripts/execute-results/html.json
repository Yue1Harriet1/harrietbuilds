{
  "hash": "3636060182421fad6994b61bf31f7e5f",
  "result": {
    "markdown": "---\ntitle: Convert R Markdown (Rmd) Files to R Scripts\nauthor: Garrick Aden-Buie\ndate: '2017-10-17'\nslug: convert-r-markdown-rmd-files-to-r-scripts\naliases:\n  - /blog/2017/10/17/convert-r-markdown-rmd-files-to-r-scripts\ncategories:\n  - Blog\ntags:\n  - pandoc\n  - R\n  - Scripts\n  - Workflow\n  - Markdown\n---\n\n\n\n\n> **tl; super dr:** I'm really not sure how `knitr::purl()` escaped my attention -- maybe I thought it didn't do something I felt was necessary at the time -- but if you've stumbled on this page looking for a way to convert an R Markdown file into an R script, then the function you are looking for is called `knitr::purl()`.\n>\n> Try `knitr::purl(input, output, documentation = 2)`. It's exactly what you're looking for.\n\n***\n\n> **tl;dr:** A [function called backstitch][gist-link] that backstitches `knitr::knit`able R Markdown files to `knitr::spin`able R Scripts.\n\nThere are two great ways of writing R Markdown reports.\nThe most well known way is to use \"literate programming\", where the writing and the code are intermingled an `.Rmd` file.\nThis is the style of file you get when you create a new \"R Markdown\" file inside RStudio.\n\nThere's another way of mixing code and writing inside a script, and it's essentially the inverse of an `.Rmd` file.\n\nIn an R Markdown file, text is considered to be writing unless you wrap it in decoration, by adding backticks around inline code or by putting code in a \"code chunk\":\n\n````markdown\n```{r chunk-name}\ntable(mtcars$cyl, mtcars$gear)\n```\n````\n\nTo get your final report, you call knitr's **`knit`** function, which runs the code chunks, knits the results into the text, and writes an output file (PDF, HTML, Word, etc.).\n\nIn the inverse universe, you write your code and text in regular R scripts, mark specific lines as regular text by starting the lines with `#'`, and you **`spin`** your code and text together instead of knitting.\n\nThis format is great for computationally-heavy scripts.\nThe other advantage is that you can call the script directly to run all the code directly, ignoring the text aspect.\nI also use it a lot when I want to quickly write up a report on a set of scripts that I've been working with.\n\nDean Attali has a [great write up from a couple years ago about `spin`][dean-attali] that I highly recommend.\nAnd there's a [quick intro to `spin` in the knitr documentation][yihui-spin], too.\n\nI usually try to keep computation and reporting scripts separate.\nBut writing up the results of your code while putting it together is an incredible paradigm for data analysis...and sometimes I keep digging and digging while writing and exploring.\nAnd then I end up with a very \"heavy\" R Markdown (or notebook), where a lot of the data processing code really should be run separately from the reporting and visualization code.\n\nBut how do you convert an R Markdown file to a regular R script (or one that you could **`spin`** if you wanted to)?\n\nI couldn't find the answer online, so I wrote a function called `backstitch` that does the conversion.\nIt only goes one way, for now: from `.Rmd` to `.R`.\nBut it lets you convert the whole R Markdown document to an R script, or just pull out the code chunks into a script (or both!).\n\nBecause it's just a function, I made it [available as a gist][gist-link], which you can source directly with `devtools`.\n\n\n::: {.cell hash='convert-r-markdown-rmd-files-to-r-scripts_cache/html/source-gist_6abb703aa35a1c75d88305cdb025e44e'}\n\n```{.r .cell-code}\ndevtools::source_gist('284671997992aefe295bed34bb53fde6', filename = 'backstitch.R')\n```\n:::\n\n\nGive it an input file or connection (`infile`), an output file name (`outfile`, leave as `NULL` to return as text vector), choose `output_type` from `script`, `code`, `both` and it does the rest of the work.\n(There's also an extra option called `chunk_header`, for you to set the initial characters for chunk sections.)\n\nFor example, using Yihui's [knitr-spin.Rmd](https://github.com/yihui/knitr/blob/master/inst/examples/knitr-spin.Rmd) example, but in reverse, we start with this file:\n\n\n::: {.cell hash='convert-r-markdown-rmd-files-to-r-scripts_cache/html/input_bb2b5dacb5c41e3609dfa6908e26f17a'}\n~~~r\nThis is a special R script which can be used to generate a report. You can\nwrite normal text in roxygen comments.\n\nFirst we set up some options (you do not have to do this):\n\n```{r setup, include=FALSE}\nlibrary(knitr)\nopts_chunk$set(fig.path = 'figure/silk-')\n```\n\nThe report begins here.\n\n```{r test-a, cache=FALSE}\n# boring examples as usual\nset.seed(123)\nx = rnorm(5)\nmean(x)\n```\n\nYou can use the special syntax {{code}} to embed inline expressions, e.g.\n`r mean(x) + 2`\nis the mean of x plus 2.\nThe code itself may contain braces, but these are not checked.  Thus,\nperfectly valid (though very strange) R code such as `{{2 + 3}} - {{4 - 5}}`\ncan lead to errors because `2 + 3}} - {{4 - 5` will be treated as inline code.\n\nNow we continue writing the report. We can draw plots as well.\n\n```{r test-b, fig.width=5, fig.height=5}\npar(mar = c(4, 4, .1, .1)); plot(x)\n```\n\nActually you do not have to write chunk options, in which case knitr will use\ndefault options. For example, the code below has no options attached:\n\n```{r }\nvar(x)\nquantile(x)\n```\n\nAnd you can also write two chunks successively like this:\n\n```{r test-chisq5}\nsum(x^2) # chi-square distribution with df 5\n```\n```{r test-chisq4}\nsum((x - mean(x))^2) # df is 4 now\n```\n\nDone. Call spin('knitr-spin.R') to make silk from sow's ear now and knit a\nlovely purse.\n~~~\n:::\n\n\nand `backstitch` it into this file:\n\n\n::: {.cell hash='convert-r-markdown-rmd-files-to-r-scripts_cache/html/output_bccb5636ab71629393f4881e7a71a60f'}\n\n```{.r .cell-code}\ninfile <- url('https://raw.githubusercontent.com/yihui/knitr/master/inst/examples/knitr-spin.Rmd')\noutput <- backstitch(infile, output_type = 'script', chunk_header = \"#+\")\ncat(\"```r\", output, \"```\", sep = \"\\n\")\n```\n\n```r\n#' This is a special R script which can be used to generate a report. You can\n#' write normal text in roxygen comments.\n#' \n#' First we set up some options (you do not have to do this):\n\n#+ setup, include=FALSE\nlibrary(knitr)\nopts_chunk$set(fig.path = 'figure/silk-')\n\n\n#' The report begins here.\n\n#+ test-a, cache=FALSE\n# boring examples as usual\nset.seed(123)\nx = rnorm(5)\nmean(x)\n\n\n#' You can use the special syntax {{code}} to embed inline expressions, e.g.\n#' {{mean(x) + 2}}\n#' is the mean of x plus 2.\n#' The code itself may contain braces, but these are not checked.  Thus,\n#' perfectly valid (though very strange) R code such as `{{2 + 3}} - {{4 - 5}}`\n#' can lead to errors because `2 + 3}} - {{4 - 5` will be treated as inline code.\n#' \n#' Now we continue writing the report. We can draw plots as well.\n\n#+ test-b, fig.width=5, fig.height=5\npar(mar = c(4, 4, .1, .1)); plot(x)\n\n\n#' Actually you do not have to write chunk options, in which case knitr will use\n#' default options. For example, the code below has no options attached:\n\n#+ \nvar(x)\nquantile(x)\n\n\n#' And you can also write two chunks successively like this:\n\n#+ test-chisq5\nsum(x^2) # chi-square distribution with df 5\n\n#+ test-chisq4\nsum((x - mean(x))^2) # df is 4 now\n\n\n#' Done. Call spin('knitr-spin.R') to make silk from sow's ear now and knit a\n#' lovely purse.\n```\n:::\n\n\n[gist-link]: https://gist.github.com/gadenbuie/284671997992aefe295bed34bb53fde6\n[dean-attali]: http://deanattali.com/2015/03/24/knitrs-best-hidden-gem-spin/\n[yihui-spin]: https://yihui.name/knitr/demo/stitch/\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}