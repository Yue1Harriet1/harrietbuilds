{
  "hash": "ba8868e5bd96253b1c2124e211a98865",
  "result": {
    "markdown": "---\ntitle: 'Reuse Rmd fragments in package vignettes, README, blog posts and more'\nauthor: Garrick Aden-Buie\ndescription: >\n  Use knitr's \"child chunks\" to reuse bits of documentation.\ndate: '2018-03-05'\nslug: dry-vignette-and-readme\naliases:\n  - /blog/2018/03/05/dry-vignette-and-readme\ncategories:\n  - Blog\ntags:\n  - R\n  - Tips\n  - Tricks\n  - R Package\n  - R Markdown\n---\n\n\n[gh-vetr]: https://github.com/brodieG/vetr\n[cran-readme-example]: https://cran.r-project.org/web/packages/knitrProgressBar/README.html\n[pkgdown]: http://pkgdown.r-lib.org/\n[r-markdown]: https://rmarkdown.rstudio.com/\n[knitr]: https://yihui.name/knitr\n[dry]: https://en.wikipedia.org/wiki/Don't_repeat_yourself\n[blogdown]: https://bookdown.org/yihui/blogdown\n[maelle]: https://twitter.com/ma_salmon\n\n**Updated on December 4, 2019** with [new advice](#update)\nthat will most likely satisfy R CMD check.\n\n***\n\nJonathan Carroll ([&commat;carroll_jono](https://twitter.com/carroll_jono)) posted a twitter poll that turned out to be quite interesting this weekend:\n\n`{{% tweet \"969442252610191361\" %}}`{=html}\n\n## What I love to see in a README\n\nPersonally, I usually find out about a package while browsing GitHub or a blog post that leads me to check out the package on GitHub.\nSo I'm very partial to a highly explanatory README.\n\nWhen I run into a new package, I'm hoping the README answers the following questions\n\n1. Why would I want to use this package?\n2. What does it look like to use this package?\n\nSo basically: an explanation of the problem the package solves and at least a short introduction to the functions or syntax of the package.\n\nThere are a lot of READMEs out there that just answer the first question with a very basic description of the package, or maybe even a detailed overview of the problem the package solves, but they don't showcase the package in action.\nI might not be the typical user, but this always seems like a missed opportunity to me.\n\nOf course, writing good documentation is tricky.\nAnd considering that a good package also has vignettes, a README, a related (<span class=\"pkg\">[blogdown]</span>) blog post, and possibly even a <span class=\"pkg\">[pkgdown]</span> site, making sure the documentation is up-to-date in all of these places can put undue burden on the package developers.\n\n## Don't Repeat Yourself, Clone Yourself\n\n![](/images/2018/the-simpsons-s01e02-Bart-the-Genius.jpg)\n\nIn the spirit of Don't Repeat Yourself and maximizing the potential of <span class=\"pkg\">[knitr]</span> and [R Markdown][r-markdown] -- and the fact that you can use R Markdown for all of the above pieces -- I remembered recently reading about child documents in knitr.\n\nI posted my idea to [Jonathan's thread](https://twitter.com/carroll_jono/status/969442252610191361) and shortly afterwards [&commat;BrodieGaslam](https://twitter.com/BrodieGaslam) wrote back with an idea that [really makes the best of child documents](https://twitter.com/BrodieGaslam/status/969682597214343168).\nHere's the full idea:\n\n### Write repeatable sections in short .Rmd files.\n\nAdapting from Brodie's\n<span class=\"pkg\">[vetr][gh-vetr]</span>\npackage as an example,\nthese files are stored in `man/fragments`:\n\n```\nvignettes/\n├── alike.Rmd\n├── styles.css\n└── vetr.Rmd\nman/\n└── fragments/\n    ├── declarative-checks.Rmd\n    ├── microbenchmark.Rmd\n    ├── related-packages.Rmd\n    ├── trust-but-verify.Rmd\n    ├── valaddin.Rmd\n    └── vetting-expressions.Rmd\n```\n\nNotice `man/fragments/related-packages.Rmd`.\nIt's a short R Markdown file with a list of (not surprisingly) related packages -- the kind of section that might be included in both the package overview vignette and the README.\n\n#### man/fragments/related-packages.Rmd >\n\n```markdown\n* [`vetr`](https://github.com/brodieG/vetr) by Yours Truly\n* [`asserthat`](https://github.com/hadley/assertthat) by Hadley Wickham\n* [`assertive`](https://www.r-pkg.org/pkg/assertive) by Richie Cotton\n* [`checkmate`](https://github.com/mllg/checkmate) by Michel Lang\n\nThe following packages also perform related tasks ...\n```\n\n**Caution**:\nIf the fragments are stored in a sub-folder of `vignettes/`,\nR CMD check may try to render them and\n[can throw an error when they fail to render](https://stackoverflow.com/questions/50078849/package-build-fails-because-vignette-does-not-find-child-rmd-files)\nbecause they aren't complete documents.\n\n### Reference the repeatable sections using the `child` chunk option.\n\n<span class=\"pkg\">knitr</span> provides a [child document chunk option](https://yihui.name/knitr/options/#child-documents) that you can use to embed R Markdown from an external file.\nAnywhere that you would re-use the documentation, you simply include the following, such as in the <span class=\"pkg\">vetr</span> package vignette.\nAgain, the following are from the [vetr package documentation files][gh-vetr].\n\n#### vignettes/vetr.Rmd >\n\n````markdown\n## Alternatives\n\nThere are many alternatives available to `vetr`.  We do a survey of the\nfollowing in our [parameter validation functions][4] review:\n\n```{r child=\"../man/fragments/related-packages.Rmd\"} \n```\n````\n\nThis R Markdown \"chunk\" can be used anywhere else you need it, such as in the package README.Rmd file.\n\n#### README.Rmd >\n\n````markdown\n## Alternatives\n\nThere are many alternatives available to `vetr`.  We do a survey of the\nfollowing in our [parameter validation functions][5] review:\n\n```{r child=\"man/fragments/related-packages.Rmd\"} \n```\n````\n\nThe major advantage here is to be able to update the documentation in one place and have those changes propagate to \"parent\" documents.\nIt's also useful to be able to arrange or choose the content shown in certain places differently depending on the location\n(or even during editing!).\nFor example, READMEs typically include installation instructions, but these would be redundant if included in the package vignettes.\n\nThe above examples can be extended for use in <span class=\"pkg\">pkgdown</span> articles (which are essentially an extension of vignettes) or for blogdown posts if you develop your package and blog source on the same machine.\n\n#### Update: December 4, 2019 {#update}\n\n[Maëlle Salmon][maelle] helpfully\n[pointed out](https://twitter.com/ma_salmon/status/1199655588457799680)\nand then\n[tracked down the solution](https://twitter.com/ma_salmon/status/1199979670026014720)\nto an issue that may pop up\nwith the method I originally proposed in this post.\n\nRather than storing your R Markdown fragments in a subfolder in `vignettes/`, such as `vignettes/fragments`, they should instead be stored in `man/fragments`.\n\nI updated the post above to match Maëlle's advice.\nThanks to [Maëlle Salmon][maelle] for the helpful advice that satisfies R CMD Check!\n\n\n***\n\nThanks [&commat;BrodieGaslam](https://twitter.com/BrodieGaslam) for the tip and [&commat;carroll_jono](https://twitter.com/carroll_jono) for kicking off this thread!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}