{
  "hash": "f8e6c105c93e0bf49ca55d9aaba02c76",
  "result": {
    "markdown": "---\ntitle: Popular Letters in Baby Names, Animated\nauthor: Garrick Aden-Buie\ndate: '2019-05-17'\nslug: popular-letters-in-babynames\ncategories:\n  - R\n  - gganimate\n  - ggplot2\n  - Visualization\ndescription: \"An animation of letter popularity in baby names\"\nimage: index_files/figure-html/babynames-any-letter-1.gif\nsource_link: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/content/blog/2019/2019-05-13-popular-letters-in-baby-names-animated.Rmarkdown\nkeywords: rstats\neditor_options:\n  chunk_output_type: console\n---\n\n\n<!-- Links -->\n\n[tidyverse]: https://tidyverse.org/\n[gganimate]: https://gganimate.com/\n[babynames]: https://github.com/hadley/babynames\n[tidyexplain]: https://github.com/gadenbuie/tidyexplain\n[hadley]: https://hadley.nz/\n[grrrck]: https://twitter.com/grrrck\n[showtext]: https://cran.r-project.org/web/packages/showtext/\n[sysfonts]: https://cran.r-project.org/web/packages/sysfonts/\n[google-fonts]: https://fonts.google.com/\n\n\n\n\n\n![](index_files/figure-html/babynames-any-letter-1.gif){.lightbox}\n\nEarlier this week, a tweet from Kieran Healy caught my attention with a neat [animation of the popularity of the final letters](https://twitter.com/kjhealy/status/1127951257392623616) of baby names.\n\n<blockquote><p dir=\"ltr\" lang=\"en\">Using gganimate to visualize a favorite finding (I think first noticed by Laura Wattenberg?) about US boys' names: the sharp, relatively recent rise in names ending in the letter 'n', at the expense of names with 'e', 'l', and 'y' endings. <a href=\"https://t.co/nRXl1KiFMe\">pic.twitter.com/nRXl1KiFMe</a></p>— Kieran Healy (&commat;kjhealy) <a href=\"https://twitter.com/kjhealy/status/1127951257392623616?ref_src=twsrc%5Etfw\">May 13, 2019</a></blockquote>\n\nI'm also a big fan of <span class=\"pkg\"><span class=\"pkg\">gganimate]</span> - check out my first project with [gganimate</span>, a collection of [join animations called _tidyexplain_][tidyexplain].\nAnd the <span class=\"pkg\">[babynames]</span> package by [Hadley Wickham][hadley] makes it pleasantly easy to work with the baby names data reported by the U.S. Social Security Administration.\n\nKieran's animations inspired several questions that I hope to answer (or at least visualize) in this post:\n\n1. What about _any_ letter within a baby's name? I understand why first and last letters would be interesting, but how has the popularity of any letter used in a baby's name changed over time?\n\n1. Can we visualize both _male_ and _female_ names in the same animation without overloading the animation?\n\n1. While I love <span class=\"pkg\">gganimate</span> and animated plots, are static plots more effective at displaying the same information?\n\nRather than answer these questions definitively or scientifically, I've stuck with the fun parts and made a few visualizations.\nI'll let you decide how effective they are.\n(And feel free to let me know on Twitter at [&commat;grrrck][grrrck].)\n\n## Getting Started\n\nTo get started, I loaded the following packages, all installed from CRAN with `install.packages()`.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_f12a10e465eb4764d25b52aa90e86d6b'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gganimate)\nlibrary(babynames)\n```\n:::\n\n\nNext, I set up a base <span class=\"pkg\">ggplot2</span> theme that I'll use throughout.\nNote that you can also set the `ggplot2` theme globally with `theme_set()`, but I'm not doing that here for complicated reasons related to my use of [knitr caching](https://yihui.name/knitr/demo/cache/) for faster rendering between post drafts.\n\nI also used the <span class=\"pkg\">[showtext]</span> and <span class=\"pkg\">[sysfonts]</span> packages.\nThese two sister packages are my go-to packages for reliably being able to use <span class=\"pkg\">Google Fonts][google-fonts] with [ggplot2</span> on any system.\n\n\n::: {.cell hash='index_cache/html/theme_3f1c5a89407e54924f3810168d468dbf'}\n\n```{.r .cell-code}\nshowtext::showtext_auto()\nsysfonts::font_add_google(\"PT Sans\")\nsysfonts::font_add_google(\"PT Sans Narrow\")\nbase_theme <-\n  theme_minimal(base_size = 16, base_family = \"PT Sans\") +\n  theme(\n    legend.position      = c(0.5, 0.9),\n    legend.text          = element_text(margin = margin(r = 10)),\n    legend.background    = element_rect(fill = \"white\", color = \"white\"),\n    legend.direction     = \"horizontal\",\n    legend.justification = \"center\",\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    axis.text     = element_text(family = \"PT Sans Narrow\"),\n    axis.text.x   = element_text(vjust = 0.9, face = \"bold\"),\n    axis.title.y  = element_text(margin = margin(r = 20)),\n    plot.subtitle = element_text(\n      size = rel(1.5), hjust = 0.5, margin = margin(t = 10)\n    ),\n    plot.caption  = element_text(color = \"grey40\", lineheight = 1.1)\n  )\n\nsex_colors <- c(\"Male\" = \"#00589A\", \"Female\" = \"#EB1455\")\ncaption_text <- paste(\n  \"Source: babynames, U.S. Social Security Administration\",\n  \"@grrrck\", \"garrickadenbuie.com\",\n  sep = \" | \"\n)\n```\n:::\n\n\n## How Popular are Letters Used Anywhere in Baby Names\n\n### Letters in Baby Names\n\nTo answer the first question, I needed to first establish what letters are used in a name, regardless of the letter's position in the name, and not counting duplicates.\nRather than repeatedly calculate this information for every year, sex, and name pair in `babynames`, I used `distinct()` from <span class=\"pkg\">dplyr</span> to obtain the list of unique names.\n\n\n::: {.cell hash='index_cache/html/babynames-and-letters_2ae4a35745deb6deccd39d93639bb671'}\n\n```{.r .cell-code}\nbabynames_and_letters <-\n  babynames %>%\n  distinct(name) %>%\n  mutate(letter = strsplit(tolower(name), character())) %>%\n  # strsplit() returns a list for each name,\n  # so 'letter' is a list-column that can be converted to a\n  # normal column with unnest()\n  unnest(letter) %>%\n  # count each letter once\n  distinct()\n\nbabynames_and_letters %>%\n  filter(name == \"Garrick\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  name    letter\n  <chr>   <chr> \n1 Garrick g     \n2 Garrick a     \n3 Garrick r     \n4 Garrick i     \n5 Garrick c     \n6 Garrick k     \n```\n:::\n:::\n\n\nThen I joined `babynames` with the `babynames_and_letters` table to get the sum of the proportions of the population (by year and sex) that have each letter in their name.\n\n\n::: {.cell hash='index_cache/html/babynames-containing_ef71a3d685b21046ce5021d52000f178'}\n\n```{.r .cell-code}\nbabynames_containing <-\n  left_join(babynames, babynames_and_letters, by = \"name\") %>%\n  group_by(letter, year, sex) %>%\n  summarize(prop = sum(prop)) %>%\n  ungroup() %>%\n  filter(year >= 1900) %>%\n  mutate(sex = recode(sex, M = \"Male\", F = \"Female\"))\n\nbabynames_containing %>%\n  filter(letter == \"g\") %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  letter  year sex      prop\n  <chr>  <dbl> <chr>   <dbl>\n1 g       1900 Female 0.0800\n2 g       1900 Male   0.0632\n3 g       1901 Female 0.0827\n4 g       1901 Male   0.0615\n5 g       1902 Female 0.0831\n6 g       1902 Male   0.0618\n```\n:::\n:::\n\n\n### Plot and Animate\n\nAt this point, my typical <span class=\"pkg\">gganimate</span> workflow is to first create a static <span class=\"pkg\">ggplot2</span> plot as a sanity check for the animation.\nIf the static plot works with `facet_wrap(~ state_column)`, then using `transition_state(state_column)` is likely to work well (although you may need to filter the data to preview only a few states).\nIn this case, I used `year` as the state column.\n\nI generally try to structure my <span class=\"pkg\">ggplot2</span> code in a consistent way (future blog post?) so I prefer having the <span class=\"pkg\">gganimate</span> specific parts at the end.\nI also directly called `gganimate::animate()` so that I could control specific parameters of the output, namely the number of frames and the size of the image.\nThe default number of frames is 100 but I'm visualizing 117 years and <span class=\"pkg\">gganimate</span> will complain (i.e. throw an error) if there aren't enough frames to cover the number of states.\n\n\n::: {.cell hash='index_cache/html/babynames-animated-popular-letter-names_5c7ca81e41aea799db44caed550969e3'}\n\n```{.r .cell-code}\nga_pop_letter <-\n  ggplot(babynames_containing) +\n  aes(letter, prop, fill = sex) +\n  geom_col(position = \"identity\", alpha = 0.6) +\n  scale_y_continuous(\n    labels = scales::percent_format(accuracy = 10),\n    expand = c(0, 0)\n  ) +\n  scale_fill_manual(values = sex_colors) +\n  labs(\n    x        = NULL,\n    y        = \"Percent of Population\",\n    fill     = NULL,\n    title    = \"How many babies have the letter ____ in their name?\",\n    subtitle = \"{closest_state}\",\n    caption  = caption_text\n  ) +\n  base_theme +\n  ease_aes(\"linear\") +\n  transition_states(\n    year, transition_length = 1, state_length = 0, wrap = FALSE\n  )\n\nga_pop_letter_animated <- animate(\n  ga_pop_letter,\n  nframes = 117*2+10,\n  end_pause = 10,\n  width = 1024,\n  height = 512\n)\n```\n:::\n\n\n\n\nThe resulting animation, below, shows the proportion of babies given a name containing (at least one of) each letter of the alphabet since 1900.\n\n![](index_files/figure-html/babynames-any-letter-1.gif){.lightbox}\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_719ae07c60d32cc54c0ea7bccc3d739b'}\n\n:::\n\n\n## First and Last Letters of Baby Names\n\nTo extract the first and last letter of each name, I wrote two small functions, `first_letter()` and `last_letter()` that use `substring()` to pull out the first and last letter of a string.\nThese are reasonably fast when applied to all of the names using `map_chr()` from <span class=\"pkg\">purrr</span> within `mutate()` to add new columns `first_letter` and `last_letter`.\n\n\n::: {.cell hash='index_cache/html/babynames_first_last_6466e2790f84dd8eefffa6f0c1e3cf62'}\n\n```{.r .cell-code}\nfirst_letter <- function(x) substring(x, 1, 1)\nlast_letter  <- function(x) substring(x, nchar(x), nchar(x))\n\nbabynames_first_last <-\n  babynames %>%\n  mutate(\n    first_letter = map_chr(name, first_letter),\n    last_letter  = map_chr(name, last_letter),\n  ) %>%\n  mutate_at(vars(contains(\"letter\")), tolower)\n\nset.seed(42)\nbabynames_first_last %>% sample_n(6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n   year sex   name         n      prop first_letter last_letter\n  <dbl> <chr> <chr>    <int>     <dbl> <chr>        <chr>      \n1  1991 M     Bobby     1508 0.000712  b            y          \n2  1900 F     Pamela       5 0.0000157 p            a          \n3  1964 F     Marline     21 0.0000107 m            e          \n4  1992 F     Carlos      31 0.0000155 c            s          \n5  1991 F     Charlene   531 0.000261  c            e          \n6  1985 F     Mariya      27 0.0000146 m            a          \n```\n:::\n:::\n\n\n### Animated\n\nFirst, let's look at the animated version of my remix of Kieran's plots.\nYou can still see the change in the use of **N** as a final letter in the names given to baby boys, as he described, but you also see the changes in female names as well.\n\n![](index_files/figure-html/babynames-last-animation-1.gif){.lightbox}\n\nHere's the code I used to produce the plot above.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_1df78ec0dc3304276815ace1238a2845'}\n\n```{.r .cell-code}\ngb_last <-\n  babynames_first_last %>%\n  filter(year >= 1900) %>%\n  mutate(sex = recode(sex, M = \"Male\", F = \"Female\")) %>%\n  group_by(year, sex, last_letter) %>%\n  summarize(prop = sum(prop)) %>%\n  ggplot() +\n  aes(last_letter, prop, fill = sex) +\n  geom_col(position = \"identity\", alpha = 0.6) +\n  scale_y_continuous(\n    labels = scales::percent_format(accuracy = 5),\n    expand = c(0, 0)\n  ) +\n  scale_fill_manual(values = sex_colors) +\n  labs(\n    x = NULL,\n    y = \"Percent of Population\",\n    fill = NULL,\n    title = \"How many baby names end with the letter ____?\",\n    subtitle = \"{closest_state}\",\n    caption = caption_text\n  ) +\n  base_theme +\n  theme(legend.position = c(0.8, 0.9)) +\n  ease_aes(\"linear\") +\n  transition_states(\n    year,\n    transition_length = 1,\n    state_length = 0, wrap = FALSE\n  )\n\ngb_last_animated <- animate(\n  gb_last,\n  nframes = 117*2+10,\n  end_pause = 10,\n  width = 1024, height = 512\n)\n```\n:::\n\n\n\n\nThen I also created a similar visualization for the starting letters of baby's names.\n\n![](index_files/figure-html/babynames-first-animation-1.gif){.lightbox}\n\nAnd here's the code to create the above animation.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_214b4c65a33538a637d9b56af9ab8570'}\n\n```{.r .cell-code}\ngb_first <-\n  babynames_first_last %>%\n  filter(year >= 1900) %>%\n  mutate(sex = recode(sex, M = \"Male\", F = \"Female\")) %>%\n  group_by(year, sex, first_letter) %>%\n  summarize(prop = sum(prop)) %>%\n  ggplot() +\n  aes(first_letter, prop, fill = sex) +\n  geom_col(position = \"identity\", alpha = 0.6) +\n  scale_y_continuous(\n    labels = scales::percent_format(accuracy = 5),\n    expand = c(0, 0)\n  ) +\n  scale_fill_manual(values = sex_colors) +\n  labs(\n    x = NULL,\n    y = \"Percent of Population\",\n    fill = NULL,\n    title = \"How many baby names start with the letter ____?\",\n    subtitle = \"{closest_state}\",\n    caption = caption_text\n  ) +\n  base_theme +\n  theme(legend.position = c(0.8, 0.9)) +\n  ease_aes(\"linear\") +\n  transition_states(\n    year,\n    transition_length = 1,\n    state_length = 0,\n    wrap = FALSE\n  )\n\ngb_first_animated <- animate(\n  gb_first,\n  nframes = 117*2+10,\n  end_pause = 10,\n  width = 1024, height = 512\n)\n```\n:::\n\n\n\n\n\n### Static\n\nI'll admit, I think the animated plots are cool,\nbut they also make it hard to reason about overall trends.\nYou have to watch the animation loop over and over, trying to watch one letter or one sex specifically.\nI feel like I'm seeing the movement but missing the picture.\n\nI thought it would be interesting to compare the animated plots with line charts showing the same information, so I swapped <span class=\"pkg\">gganimate</span>'s `transition_state(year)` for <span class=\"pkg\">ggplot2</span>'s `facet_wrap(~ letter)`.\n\nI somewhat like these plots more than their animated versions.\nI get the sense that I'm seeing a fuller picture (or more easy-to-compare picture) of the overall trends in starting and ending letters of baby names.\n\n![](index_files/figure-html/babynames-last-static-1.png){.lightbox}\n\n![](index_files/figure-html/babynames-first-static-1.png){.lightbox}\n\nHere's the code to produce the static image of the trends in the last letter of baby names.\n\n\n::: {.cell hash='index_cache/html/babynames-last-static_b991e7eea6b26f3e665d678e95a006b2'}\n\n```{.r .cell-code}\nbabynames_first_last %>%\n  filter(year >= 1900) %>%\n  mutate(sex = recode(sex, M = \"Male\", F = \"Female\")) %>%\n  group_by(year, sex, last_letter) %>%\n  summarize(prop = sum(prop)) %>%\n  ungroup() %>%\n  mutate(last_letter = toupper(last_letter)) %>%\n  ggplot() +\n  aes(year, prop) +\n  geom_text(\n    data = tibble(\n      last_letter = LETTERS,\n      x = 1900+117/2,\n      prop = 0\n    ),\n    aes(label = last_letter, x = x),\n    size = rel(15),\n    vjust = -0.12,\n    color = \"grey75\",\n    family = \"PT Sans\"\n  ) +\n  geom_line(aes(color = sex)) +\n  facet_wrap(~ last_letter) +\n  scale_y_continuous(\n    labels = scales::percent_format(5),\n    breaks = c(0, 0.3)\n  ) +\n  scale_x_continuous(breaks = c(1900, 2000)) +\n  scale_color_manual(values = sex_colors) +\n  labs(\n    x = NULL,\n    y = \"Proportion of Population\",\n    title = \"How many babies have names ending with the letter ____?\",\n    caption = caption_text,\n    color = NULL\n  ) +\n  base_theme +\n  theme(\n    strip.text = element_blank(),\n    axis.text.x = element_text(face = \"plain\"),\n    legend.position = c(0.7, 0.025),\n    panel.grid.minor.y = element_blank()\n  )\n```\n:::\n\n\nAnd here is the code to produce the plot of trends in the first letter of baby names.\n\n\n::: {.cell hash='index_cache/html/babynames-first-static_97310c673d141f27af969bc496afc196'}\n\n```{.r .cell-code}\nbabynames_first_last %>%\n  filter(year >= 1900) %>%\n  mutate(sex = recode(sex, M = \"Male\", F = \"Female\")) %>%\n  group_by(year, sex, first_letter) %>%\n  summarize(prop = sum(prop)) %>%\n  ungroup() %>%\n  mutate(first_letter = toupper(first_letter)) %>%\n  ggplot() +\n  aes(year, prop) +\n  geom_text(\n    data = tibble(\n      first_letter = LETTERS,\n      x = 1900+117/2,\n      prop = 0\n    ),\n    aes(label = first_letter, x = x),\n    size = rel(15),\n    vjust = -0.2,\n    color = \"grey75\",\n    family = \"PT Sans\"\n  ) +\n  geom_line(aes(color = sex)) +\n  facet_wrap(~ first_letter) +\n  scale_y_continuous(\n    labels = scales::percent_format(5),\n    breaks = c(0, 0.2)\n  ) +\n  scale_x_continuous(breaks = c(1900, 2000)) +\n  scale_color_manual(values = sex_colors) +\n  labs(\n    x = NULL,\n    y = \"Proportion of Population\",\n    title = \"How many babies have names starting with the letter ____?\",\n    caption = caption_text,\n    color = NULL\n  ) +\n  base_theme +\n  theme(\n    strip.text = element_blank(),\n    axis.text.x = element_text(face = \"plain\"),\n    legend.position = c(0.7, 0.025),\n    panel.grid.minor.y = element_blank()\n  )\n```\n:::\n\n\n\n***\n\nIf you made it this far, thanks for reading!\nI'd love to hear your opinion on these plots, or see your own versions -- animated or not!\nJust drop me a line on Twitter at [&commat;grrrck][grrrck].\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}