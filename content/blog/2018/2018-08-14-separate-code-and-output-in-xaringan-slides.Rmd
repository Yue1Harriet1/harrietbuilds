---
title: Separate Code and Output in xaringan slides
author: Garrick Aden-Buie
date: '2018-08-14'
slug: separate-code-and-output-in-xaringan-slides
categories:
  - Blog
tags:
  - R
  - xaringan
---

[xaringan]: https://slides.yihui.name/xaringan/
[trug]: https://tampausers.github.io/
[ggplot2]: https://ggplot2.tidyverse.org

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Thanks to a recent tweet by [Gina Reynolds](https://twitter.com/EvaMaeRey), I was reminded that I have wanted to write up a short post detailing a couple of [xaringan] tricks I learned when creating [my presentation](https://www.garrickadenbuie.com/talk/trug-ggplot2/) on [ggplot2] for the [Tampa R Users Group][trug] 

`r blogdown::shortcode("tweet", "1029104656763572226")`

For the ggplot presentation, I really wanted to be able to highlight the code and the plot together.
The standard appearance in RMarkdown is for the code output to appear immediately following the code chunk that created it.

```{r echo=TRUE}
library(ggplot2)
ggplot(iris) + 
  aes(Sepal.Length, Sepal.Width, color = Species) + 
  geom_point()
```

## Code and Figure Side-by-Side

This looks great on the web, but when presenting with limited screen real estate, I wanted slides that look more like this:

```{r fig.asp=0.4}
slide <- tibble::data_frame(
  x = c(0, 0.52), 
  x2 = c(0.48, 1), 
  xm = c(0.24, 0.52+0.24),
  z = c("code", "plot")) 


ggplot(slide) +
  aes(xmin = x, xmax = x2, ymin = 0, fill = z, ymax = 1) +
  geom_rect() +
  geom_text(
    aes(label = z, x = xm, y = 0.5),
    color = "white", hjust = 0.5, size = 12) +
  scale_fill_manual(values = c("code" = "#002B36", plot = "#dc322f")) +
  theme_void() +
  guides(fill = FALSE)
```

In general, with xaringan, you use a two column layout by placing the left and right column content inside `.pull-left[]` and `.pull-right[]` respectively.
What I wanted to do, then was have the code chunk be in the left column and the plot output in the right column.

````markdown
.pull-left[
`r ''````{r}
# code chunk here
```
]

.pull-right[
Plot output here!
]
````

But the default action of `knitr` will place the plot output inside the `.pull-left[]` block, keeping it in the left column.

To solve this problem, we need to tell knitr to hold off on evaluating the code output and to place the results in a different chunk.
To do this, we can use the `ref.label` [code chunk option][TODO KNITR CHUNK LINK]:

````markdown
.pull-left[
```{r plot-label, eval=FALSE}`r ''`
# code chunk here
ggplot(iris) + 
  aes(Sepal.Length, 
      Sepal.Width, 
      color = Species) + 
  geom_point()
```
]

.pull-right[
```{r plot-label-out, ref.label="plot-label", echo=FALSE}`r ''`
```
]
````

![](/blog/2018/2018-08-14-separate-code-and-output-in-xaringan-slides_files/pull-left-right.png)

This works pretty well, but the plots ended up being somewhat squished, so I created two CSS classess for the left and right columns.

```css
/* custom.css */
.left-code {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
}
.right-plot {
  width: 60%;
  float: right;
  padding-left: 1%;
}
```

I then used the following options in the YAML header of xaringan

```yaml
output:
  xaringan::moon_reader:
    css: ["default", "custom.css"]
    nature:
      ratio: 16:9
```

and changed `.pull-left[]` &#x27A1; `.left-code[]` and `.pull-right[]` &#x27A1; `.right-plot[]`.

````markdown
.left-code[
```{r plot-label, eval=FALSE}`r ''`
# code chunk here
ggplot(iris) + 
  aes(Sepal.Length, 
      Sepal.Width, 
      color = Species) + 
  geom_point()
```
]

.right-plot[
```{r plot-label-out, ref.label="plot-label", echo=FALSE, out.width="100%"}`r ''`
```
]
````

![](/blog/2018/2018-08-14-separate-code-and-output-in-xaringan-slides_files/left-code-right-plot.png)


## Plot-In-Picture - Plot in Small Callout Box

The _side-by-side_ layout works well when the code is small, but for plot requiring more code, I wanted to be able to see all of the code while still retaining a preview of the plot we were building up.

The inspiration for this layout is the "Picture in Picture" TV feature.

The xarinan code looks like...

````markdown
```{r large-plot, eval=FALSE}`r ''`
ggplot(iris) + 
  aes(Sepal.Length, 
      Sepal.Width, 
      color = Species) + 
  geom_point(size = 4) +
  labs(x = 'Sepal Length', 
       y = 'Sepal Width') + 
  theme_minimal() +
  theme(
    text = element_text(size = 24, family = "PT Sans")
  )
```

.plot-callout[
```{r large-plot-callout, ref.label="large-plot", fig.callout=TRUE}`r ''`
```
]
````

The `fig.callout=TRUE` is a custom knitr chunk option I created that sets some default chunk values for the callout chunks.

````markdown
```{r setup, include=FALSE}`r ''`
knitr::opts_hooks$set(fig.callout = function(options) {
  if (options$fig.callout) {
    options$echo <- FALSE
    options$out.height <- "99%"
    options$fig.width <- 16
    options$fig.height <- 8
  }
  options
})
```
````

And the CSS required

```css
/* custom.css */
.plot-callout {
  height: 225px;
  width: 450px;
  bottom: 5%;
  right: 5%;
  position: absolute;
  padding: 0px;
}
.plot-callout img {
  width: 100%;
  border: 4px solid #23373B;
}
```

![](/blog/2018/2018-08-14-separate-code-and-output-in-xaringan-slides_files/plot-callout.png)